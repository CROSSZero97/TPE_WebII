<?php require __DIR__ . '/templates/header.phtml'; ?>
<h1>Locales</h1>

<form method="GET" action="/WebII_TPE/home">
    <input type="hidden" name="action" value="home">
    <label for="order">Ordenar por:</label>
    <select id="order" onchange="window.location.href='/WebII_TPE/home/' + this.value;">
        <option value="nombre" <?= ($alias ?? '') === 'nombre' ? 'selected' : '' ?>>Nombre</option>
        <option value="espera" <?= ($alias ?? '') === 'espera' ? 'selected' : '' ?>>Espera</option>
        <option value="precios" <?= ($alias ?? '') === 'precios' ? 'selected' : '' ?>>Precios</option>
    </select>
</form>



<?php if(empty($locals)): ?>
    <p>No hay locales registrados.</p>
<?php else: ?>
    <table>
        <tr><th>Nombre</th><th>Espera</th><th>Especial</th><th>Precio especial</th>
            <?php if(!empty($user) && $user->admin==1): ?><th>Acciones</th><?php endif; ?>
        </tr>
        <?php foreach($locals as $l): ?>
            <tr>
                <td><?= htmlspecialchars($l['lclnombre']) ?></td>
                <td><?= htmlspecialchars($l['lclespera']) ?></td>
                <td><?= htmlspecialchars($l['especial_nombre'] ?? 'Sin especial') ?></td>
                <td><?= isset($l['especial_precio']) ? '$' . number_format($l['especial_precio'], 2) : 'â€”' ?></td>
                <?php if(!empty($user) && $user->admin==1): ?>
                    <td>
                        <a href="/WebII_TPE/local_edit/<?= intval($l['id']) ?>">Editar</a>
                        <form method="POST" action="/WebII_TPE/delete" style="display:inline">
                            <input type="hidden" name="id" value="<?= intval($l['id']) ?>">
                            <button onclick="return confirm('Eliminar?')">Borrar</button>
                        </form>
                    </td>
                <?php endif; ?>
            </tr>
        <?php endforeach; ?>
    </table>
<?php endif; ?>